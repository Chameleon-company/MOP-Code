{% block head %}
<link href="{{ url_for('static', filename='styles/use-case.css') }}" rel="stylesheet" />
<script src="{{ url_for('static', filename='highlight/highlight.min.js') }}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>

<!-- Load mathjax -->
<script s="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-MML-AM_CHTML-full,Safe"></script>

<!-- MathJax configuration -->
<script type="text/x-mathjax-config">
init_mathjax = function() {
    if (window.MathJax) {
    // MathJax loaded
        MathJax.Hub.Config({
            TeX: {
                equationNumbers: {
                autoNumber: "AMS",
                useLabelIds: true
                }
            },
            tex2jax: {
                inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
                processEscapes: true,
                processEnvironments: true
            },
            displayAlign: 'center',
            CommonHTML: {
                linebreaks: { 
                automatic: true 
                }
            },
            "HTML-CSS": {
                linebreaks: { 
                automatic: true 
                }
            }
        });
    
        MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
    }
}
init_mathjax();
</script>
<!-- End of mathjax configuration -->

{% endblock %}
<!--head ends here!!!-->

{% block content %}

<div class="jp-Notebook container" data-jp-theme-light="true" data-jp-theme-name="JupyterLab Light">

  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <div class="usecase-title">New Business Location Use Case</div>
          <div class="usecase-authors"><b>Authored by: </b> Steven Tuften</div>
        </div>
      </div>
    </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <div class="usecase-duration"><b>Duration:</b> 90 mins</div>
          <div class="usecase-level-skill">
            <div class="usecase-level"><b>Level: </b>Intermediate</div>
            <div class="usecase-skill"><b>Pre-requisite Skills: </b>Python</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <div class="usecase-section-header">Scenario</div>
        </div>
      </div>
    </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <h4
            id="As-a-Cafe,-Restaurant-or-Bar,-I-am-looking-for-commercial-space-in-the-City-of-Melbourne-where-I-can-open-a-new-venue-or-extend-my-existing-venue.">
            As a Cafe, Restaurant or Bar, I am looking for commercial space in the City of Melbourne where I can open a
            new venue or extend my existing venue.<a class="anchor-link"
              href="#As-a-Cafe,-Restaurant-or-Bar,-I-am-looking-for-commercial-space-in-the-City-of-Melbourne-where-I-can-open-a-new-venue-or-extend-my-existing-venue.">&#182;</a>
          </h4>
          <h4
            id="I-would-like-to-know-where-similar-businesses-are-located-and-the-density-of-residents-and-office-workers-in-comparison.">
            I would like to know where similar businesses are located and the density of residents and office workers in
            comparison.<a class="anchor-link"
              href="#I-would-like-to-know-where-similar-businesses-are-located-and-the-density-of-residents-and-office-workers-in-comparison.">&#182;</a>
          </h4>
          <h4
            id="I-want-to-know-the-number-of-seats-I-should-provide-based-on-seating-capacity-at-other-similar-establishments-in-the-same-area.">
            I want to know the number of seats I should provide based on seating capacity at other similar
            establishments in the same area.<a class="anchor-link"
              href="#I-want-to-know-the-number-of-seats-I-should-provide-based-on-seating-capacity-at-other-similar-establishments-in-the-same-area.">&#182;</a>
          </h4>
        </div>
      </div>
    </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <div class="usecase-section-header">What this use case will teach you</div>
        </div>
      </div>
    </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <p>At the end of this use case you will:</p>
          <ul>
            <li>understand what CLUE data is and how to access it</li>
            <li>have explored a dataset derived from the CLUE survey</li>
            <li>learnt how to visualise CLUE data using different mapping visualisation techniques</li>
          </ul>

        </div>
      </div>
    </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <div class="usecase-section-header">A brief introduction to CLUE data</div>
        </div>
      </div>
    </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <p>The City of Melbourne conducts a comprehensive bi-annual survey of its residents and businesses called the
            "Census of Land Use and Employment (CLUE)". CLUE captures key information on land use, employment, and
            economic activity across the City of Melbourne.</p>
          <p>CLUE datasets are a valuable tool for businesses looking to invest in the City of Melbourne and for
            researchers wanting to understand those factors that influence and shape the social and economic dynamics of
            Australia's second largest metropolis and one of the world's most liveable cities.</p>
          <p>CLUE data assists the City of Melbourne's business planning, policy development and strategic decision
            making. Investors, consultants, students, urban researchers, property analysts, businesses and developers
            can take advantage of CLUE to understand customers, the marketplace and the changing form and nature of the
            city.</p>
          <p>Source: <strong><a
                href="https://data.melbourne.vic.gov.au/stories/s/CLUE/rt3z-vy3t?src=hdr">CLUE</a></strong></p>
          <p>This use case utilises various CLUE datasets to illustrate their value to Data Scientists, Researchers and
            Software Developers.</p>
          <h3 id="CLUE-Geospatial-Data">CLUE Geospatial Data<a class="anchor-link"
              href="#CLUE-Geospatial-Data">&#182;</a></h3>
          <p>CLUE Data is often coded to a specific location (Latitude and Longitude) and/or to a City precinct,
            referred to as the "CLUE small area". Datasets may also include the individual city block within a precinct
            referred to by its CLUE Block ID.</p>
          <p>The geospatial coordinates describing these areas as polygons can be downloaded in GeoJSON format and used
            to show shaded areas on a map, known as a choropleth map. This can be a useful technique for illustrating
            broad trends or statistics for a city area rather than a specific location.</p>
          <p>A map visualisation of CLUE Blocks and small areas can be found at the following links:</p>
          <ul>
            <li><strong><a
                  href="https://data.melbourne.vic.gov.au/Business/Small-Areas-for-Census-of-Land-Use-and-Employment-/gei8-3w86">CLUE
                  small areas</a></strong></li>
            <li><strong><a
                  href="https://data.melbourne.vic.gov.au/Business/Blocks-for-Census-of-Land-Use-and-Employment-CLUE-/aia8-ryiq">CLUE
                  Blocks</a></strong> </li>
          </ul>

        </div>
      </div>
    </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <div class="usecase-section-header">Which CLUE data should I use?</div>
        </div>
      </div>
    </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <p>To begin we shall first import the necessary libraries to support our exploratory data analysis and
            visualisation of the CLUE data.</p>
          <p>The following are core packages required for this exercise:</p>
          <ul>
            <li>The plotly.express package lets use build interact maps using map box services.</li>
          </ul>

        </div>
      </div>
    </div>
  </div>

  <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
        <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
          <div class="snippet-language">
            <span class="icon"><i class="fab fa-python"></i></span>
            <span class=>Python</span>
          </div>
          <figure class=" highlight hl-ipython3">
            <pre><code class="language-python" data-lang="python"><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objs</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
</code></pre>
          </figure>


        </div>
      </div>
    </div>

  </div>

  <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
        <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
          <div class="snippet-language">
            <span class="icon"><i class="fab fa-python"></i></span>
            <span class=>Python</span>
          </div>

          <figure class=" highlight hl-ipython3">
            <pre><code class="language-python" data-lang="python"><span></span><span class="c1">#calling the Residential Dwelling Dataset </span>
<span class="n">res_dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'https://data.melbourne.vic.gov.au/api/v2/catalog/datasets/residential-dwellings/exports/csv?limit=-1&amp;offset=0&amp;timezone=UTC'</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">";"</span><span class="p">)</span>

<span class="c1">#Filter Residential dataset for only year 2020</span>
<span class="n">res_dataset</span> <span class="o">=</span> <span class="n">res_dataset</span><span class="p">[</span><span class="n">res_dataset</span><span class="p">[</span><span class="s2">"census_year"</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2020</span><span class="p">]</span>

<span class="c1">#rename the columns to match the columns named by original coder Steven Tuften. As well, to change the dataset to match the column order</span>
<span class="n">res_dataset</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">'property_id'</span><span class="p">:</span> <span class="s1">'pbs_property_id'</span><span class="p">,</span> <span class="s1">'base_property_id'</span><span class="p">:</span> <span class="s1">'bps_base_id'</span><span class="p">,</span><span class="s2">"building_address"</span><span class="p">:</span><span class="s2">"street_name"</span><span class="p">,</span><span class="s2">"longitude"</span><span class="p">:</span><span class="s2">"x_coordinate"</span><span class="p">,</span><span class="s2">"latitude"</span><span class="p">:</span><span class="s2">"y_coordinate"</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">columns_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"census_year"</span><span class="p">,</span><span class="s2">"block_id"</span><span class="p">,</span><span class="s2">"pbs_property_id"</span><span class="p">,</span><span class="s2">"bps_base_id"</span><span class="p">,</span><span class="s2">"street_name"</span><span class="p">,</span><span class="s2">"clue_small_area"</span><span class="p">,</span><span class="s2">"dwelling_type"</span><span class="p">,</span><span class="s2">"dwelling_number"</span><span class="p">,</span><span class="s2">"x_coordinate"</span><span class="p">,</span><span class="s2">"y_coordinate"</span><span class="p">]</span>
<span class="n">res_dataset</span> <span class="o">=</span> <span class="n">res_dataset</span><span class="p">[</span><span class="n">columns_list</span><span class="p">]</span>
</code></pre>
          </figure>


        </div>
      </div>
    </div>

  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <p>Next, we will look at one of the CLUE datasets to better understand its structure and how we can use it.
          </p>
          <p>Our data requirements from this use case include the following:</p>
          <ul>
            <li>Number of Residential Dwellings per CLUE Block</li>
            <li>Number of Employees per CLUE Block</li>
            <li>Number of Seats (Indoor and Outdoor) per Venue and CLUE Block</li>
          </ul>
          <p>For this exercise, we shall start by examining the Residential Dwelling dataset.
            Each dataset in the Melbourne Open Data Portal has a unique identifier which can be used to retrieve the
            dataset using the sodapy library.</p>
          <p>This dataset is placed in a Pandas dataframe and we will inspect the first three rows.</p>

        </div>
      </div>
    </div>
  </div>
  <div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
        <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
          <div class="snippet-language">
            <span class="icon"><i class="fab fa-python"></i></span>
            <span class=>Python</span>
          </div>

          <figure class=" highlight hl-ipython3">
            <pre><code class="language-python" data-lang="python"><span></span><span class="c1"># Retrieve the "CLUE Residential Dwellings 2020" dataset</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'The shape of dataset is </span><span class="si">{</span><span class="n">res_dataset</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">.'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Below are the first few rows of this dataset:'</span><span class="p">)</span>

<span class="c1"># Transpose the DataFrame for easier visual comparison. </span>
<span class="n">res_dataset</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</code></pre>
          </figure>


        </div>
      </div>
    </div>

    <div class="jp-Cell-outputWrapper">
      <div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
      </div>


      <div class="jp-OutputArea jp-Cell-outputArea">
        <div class="jp-OutputArea-child">

          <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


          <div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
            <pre>The shape of dataset is (10403, 10).
Below are the first few rows of this dataset:
</pre>
          </div>
        </div>
        <div class="jp-OutputArea-child jp-OutputArea-executeResult">

          <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[&nbsp;]:</div>



          <div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output jp-OutputArea-executeResult"
            data-mime-type="text/html">
            <div>
              <style scoped>
                .dataframe tbody tr th:only-of-type {
                  vertical-align: middle;
                }

                .dataframe tbody tr th {
                  vertical-align: top;
                }

                .dataframe thead th {
                  text-align: right;
                }
              </style>
              <table border="1" class="dataframe">
                <thead>
                  <tr style="text-align: right;">
                    <th></th>
                    <th>3392</th>
                    <th>3393</th>
                    <th>3394</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th>census_year</th>
                    <td>2020</td>
                    <td>2020</td>
                    <td>2020</td>
                  </tr>
                  <tr>
                    <th>block_id</th>
                    <td>333</td>
                    <td>333</td>
                    <td>333</td>
                  </tr>
                  <tr>
                    <th>pbs_property_id</th>
                    <td>107732</td>
                    <td>107735</td>
                    <td>107964</td>
                  </tr>
                  <tr>
                    <th>bps_base_id</th>
                    <td>107732</td>
                    <td>107735</td>
                    <td>107964</td>
                  </tr>
                  <tr>
                    <th>street_name</th>
                    <td>1-3 Provost Street NORTH MELBOURNE VIC 3051</td>
                    <td>11 Provost Street NORTH MELBOURNE VIC 3051</td>
                    <td>642-650 Queensberry Street NORTH MELBOURNE VIC...</td>
                  </tr>
                  <tr>
                    <th>clue_small_area</th>
                    <td>North Melbourne</td>
                    <td>North Melbourne</td>
                    <td>North Melbourne</td>
                  </tr>
                  <tr>
                    <th>dwelling_type</th>
                    <td>House/Townhouse</td>
                    <td>House/Townhouse</td>
                    <td>Residential Apartments</td>
                  </tr>
                  <tr>
                    <th>dwelling_number</th>
                    <td>1</td>
                    <td>1</td>
                    <td>6</td>
                  </tr>
                  <tr>
                    <th>x_coordinate</th>
                    <td>144.9478</td>
                    <td>144.94737</td>
                    <td>144.94607</td>
                  </tr>
                  <tr>
                    <th>y_coordinate</th>
                    <td>-37.80223</td>
                    <td>-37.80223</td>
                    <td>-37.80243</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

        </div>

      </div>

    </div>

  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <p>We can see that there are 10,403 records and 10 fields describing each record.</p>
          <p>Each record show us the number of dwellings for each individual property and the type of dwelling e.g.
            House/Townhouse, Residential Apartments, etc.</p>
          <p>The location of each property is given using:</p>
          <ul>
            <li>Latitude and Longitude</li>
            <li>CLUE Small Area and Block ID</li>
            <li>Property Id</li>
          </ul>
          <p>The Census year that the data was collected is also shown.</p>
          <p>For our analysis of this dataset and others we will be restricting our analysis to the 2020 CLUE Census and
            summarising the data to CLUE Block level.</p>

        </div>
      </div>
    </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <div class="usecase-section-header">Summarising Residential Dwelling data</div>
        </div>
      </div>
    </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <p>We want to plot the density of both residential dwellings and employment at city block level rather than a
            specific property or address. We can use a <strong><a
                href="https://en.wikipedia.org/wiki/Choropleth_map">choropleth map</a></strong> to do this.</p>
          <p>Let's start by summarising the data at CLUE small area and Block level.</p>
          <p><em>Note: We include CLUE Small Area as one of our group by fields so we can display the CLUE Small area
              name in the popup window when you hover over the area on the map.</em></p>
          <p>We want to summarise the data by summing the number of dwellings across all rows in the same CLUE Block.
          </p>
          <p>The following cell creates a dataframe containing this summary of residential dwellings.</p>

        </div>
      </div>
    </div>
  </div>
  <div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
        <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
          <div class="snippet-language">
            <span class="icon"><i class="fab fa-python"></i></span>
            <span class=>Python</span>
          </div>

          <figure class=" highlight hl-ipython3">
            <pre><code class="language-python" data-lang="python"><span></span><span class="c1"># Cast datatypes to correct type so we can summarise</span>
<span class="n">res_dataset</span><span class="p">[[</span><span class="s1">'census_year'</span><span class="p">,</span> <span class="s1">'dwelling_number'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">res_dataset</span><span class="p">[[</span><span class="s1">'census_year'</span><span class="p">,</span> <span class="s1">'dwelling_number'</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">res_dataset</span><span class="p">[[</span><span class="s1">'x_coordinate'</span><span class="p">,</span> <span class="s1">'y_coordinate'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">res_dataset</span><span class="p">[[</span><span class="s1">'x_coordinate'</span><span class="p">,</span> <span class="s1">'y_coordinate'</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">res_dataset</span> <span class="o">=</span> <span class="n">res_dataset</span><span class="o">.</span><span class="n">convert_dtypes</span><span class="p">()</span> <span class="c1"># convert remaining to string</span>
<span class="n">res_dataset</span><span class="o">.</span><span class="n">dtypes</span>

<span class="c1"># create the aggregate dataset</span>
<span class="n">groupbyfields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'block_id'</span><span class="p">,</span><span class="s1">'clue_small_area'</span><span class="p">]</span>
<span class="n">aggregatebyfields</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'dwelling_number'</span><span class="p">:</span> <span class="p">[</span><span class="s2">"sum"</span><span class="p">]}</span>

<span class="n">dwellingsByBlock</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">res_dataset</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">groupbyfields</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">aggregatebyfields</span><span class="p">))</span>

<span class="c1"># Dataframse Group by creates two levels of headings</span>
<span class="c1"># so we flatten the headings to make it easier to extract data for plotting</span>
<span class="n">dwellingsByBlock</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">dwellingsByBlock</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">)</span> <span class="c1"># flatten column header</span>
<span class="n">dwellingsByBlock</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">'clue_small_area'</span><span class="p">:</span> <span class="s1">'clue_area'</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#rename to match GeoJSON extract</span>
<span class="n">dwellingsByBlock</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">'dwelling_numbersum'</span><span class="p">:</span> <span class="s1">'dwelling_count'</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dwellingsByBlock</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre>
          </figure>


        </div>
      </div>
    </div>

    <div class="jp-Cell-outputWrapper">
      <div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
      </div>


      <div class="jp-OutputArea jp-Cell-outputArea">
        <div class="jp-OutputArea-child jp-OutputArea-executeResult">

          <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[&nbsp;]:</div>



          <div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output jp-OutputArea-executeResult"
            data-mime-type="text/html">
            <div>
              <style scoped>
                .dataframe tbody tr th:only-of-type {
                  vertical-align: middle;
                }

                .dataframe tbody tr th {
                  vertical-align: top;
                }

                .dataframe thead th {
                  text-align: right;
                }
              </style>
              <table border="1" class="dataframe">
                <thead>
                  <tr style="text-align: right;">
                    <th></th>
                    <th>block_id</th>
                    <th>clue_area</th>
                    <th>dwelling_count</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th>0</th>
                    <td>1</td>
                    <td>Melbourne (CBD)</td>
                    <td>385</td>
                  </tr>
                  <tr>
                    <th>1</th>
                    <td>11</td>
                    <td>Melbourne (CBD)</td>
                    <td>690</td>
                  </tr>
                  <tr>
                    <th>2</th>
                    <td>12</td>
                    <td>Melbourne (CBD)</td>
                    <td>190</td>
                  </tr>
                  <tr>
                    <th>3</th>
                    <td>13</td>
                    <td>Melbourne (CBD)</td>
                    <td>112</td>
                  </tr>
                  <tr>
                    <th>4</th>
                    <td>14</td>
                    <td>Melbourne (CBD)</td>
                    <td>99</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

        </div>

      </div>

    </div>

  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <div class="usecase-section-header">Visualising Residential Dwelling on a Choropleth Map</div>
        </div>
      </div>
    </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <p>We use the <strong><a href="https://plotly.com/python/">Plotly Python Open Source Graphing
                Library</a></strong> to generate maps from <strong><a
                href="https://www.mapbox.com/">mapbox</a></strong>.</p>
          <p>Creating a choropleth map requires us to know the geometry(shape) of each CLUE Block area as a collection
            of latitude and longitude points defining a polygon. This data can be downloaded from the Melbourne Open
            Data Portal in <strong><a href="https://en.wikipedia.org/wiki/GeoJSON">GeoJSON</a></strong> format.</p>
          <p>We also need to supply the data to be used to highlight the CLUE Blocks and that data must include the same
            unique identifier for each Block contained in the GeoJSON data set.</p>
          <p>Below we extract the Melbourne CLUE Block polygons into a GeoJSON datatype.</p>

        </div>
      </div>
    </div>
  </div>
  <div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
        <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
          <div class="snippet-language">
            <span class="icon"><i class="fab fa-python"></i></span>
            <span class=>Python</span>
          </div>

          <figure class=" highlight hl-ipython3">
            <pre><code class="language-python" data-lang="python"><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>

<span class="n">block</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">'https://data.melbourne.vic.gov.au/api/v2/catalog/datasets/blocks-for-census-of-land-use-and-employment-clue/exports/geojson'</span><span class="p">)</span> 
<span class="n">block</span>
</code></pre>
          </figure>


        </div>
      </div>
    </div>

    <div class="jp-Cell-outputWrapper">
      <div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
      </div>


      <div class="jp-OutputArea jp-Cell-outputArea">
        <div class="jp-OutputArea-child jp-OutputArea-executeResult">

          <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[&nbsp;]:</div>



          <div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output jp-OutputArea-executeResult"
            data-mime-type="text/html">
            <div>
              <style scoped>
                .dataframe tbody tr th:only-of-type {
                  vertical-align: middle;
                }

                .dataframe tbody tr th {
                  vertical-align: top;
                }

                .dataframe thead th {
                  text-align: right;
                }
              </style>
              <table border="1" class="dataframe">
                <thead>
                  <tr style="text-align: right;">
                    <th></th>
                    <th>geo_point_2d</th>
                    <th>block_id</th>
                    <th>clue_area</th>
                    <th>geometry</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th>0</th>
                    <td>{'lon': 144.9421522923356, 'lat': -37.78851721...</td>
                    <td>925</td>
                    <td>Parkville</td>
                    <td>POLYGON ((144.94214 -37.78757, 144.94100 -37.7...</td>
                  </tr>
                  <tr>
                    <th>1</th>
                    <td>{'lon': 144.9428068448982, 'lat': -37.78752314...</td>
                    <td>924</td>
                    <td>Parkville</td>
                    <td>POLYGON ((144.94214 -37.78757, 144.94319 -37.7...</td>
                  </tr>
                  <tr>
                    <th>2</th>
                    <td>{'lon': 144.94536433435934, 'lat': -37.7803563...</td>
                    <td>930</td>
                    <td>Parkville</td>
                    <td>POLYGON ((144.94259 -37.77872, 144.94202 -37.7...</td>
                  </tr>
                  <tr>
                    <th>3</th>
                    <td>{'lon': 144.94336441344424, 'lat': -37.8072018...</td>
                    <td>412</td>
                    <td>West Melbourne (Residential)</td>
                    <td>POLYGON ((144.94271 -37.80732, 144.94370 -37.8...</td>
                  </tr>
                  <tr>
                    <th>4</th>
                    <td>{'lon': 144.94240782994808, 'lat': -37.8067063...</td>
                    <td>410</td>
                    <td>West Melbourne (Residential)</td>
                    <td>POLYGON ((144.94271 -37.80732, 144.94285 -37.8...</td>
                  </tr>
                  <tr>
                    <th>...</th>
                    <td>...</td>
                    <td>...</td>
                    <td>...</td>
                    <td>...</td>
                  </tr>
                  <tr>
                    <th>601</th>
                    <td>{'lon': 144.92542680884995, 'lat': -37.7881674...</td>
                    <td>2502</td>
                    <td>Kensington</td>
                    <td>POLYGON ((144.92464 -37.78880, 144.92464 -37.7...</td>
                  </tr>
                  <tr>
                    <th>602</th>
                    <td>{'lon': 144.92690534228524, 'lat': -37.7883951...</td>
                    <td>2506</td>
                    <td>Kensington</td>
                    <td>POLYGON ((144.92715 -37.78854, 144.92736 -37.7...</td>
                  </tr>
                  <tr>
                    <th>603</th>
                    <td>{'lon': 144.94077827466833, 'lat': -37.7887369...</td>
                    <td>2382</td>
                    <td>North Melbourne</td>
                    <td>POLYGON ((144.94216 -37.78939, 144.94100 -37.7...</td>
                  </tr>
                  <tr>
                    <th>604</th>
                    <td>{'lon': 144.9399716568005, 'lat': -37.79303223...</td>
                    <td>2388</td>
                    <td>North Melbourne</td>
                    <td>POLYGON ((144.93945 -37.79223, 144.93919 -37.7...</td>
                  </tr>
                  <tr>
                    <th>605</th>
                    <td>{'lon': 144.92574417349726, 'lat': -37.7891116...</td>
                    <td>2548</td>
                    <td>Kensington</td>
                    <td>POLYGON ((144.92382 -37.79008, 144.92385 -37.7...</td>
                  </tr>
                </tbody>
              </table>
              <p>606 rows Ã— 4 columns</p>
            </div>
          </div>

        </div>

      </div>

    </div>

  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <p>Now using just one function call called 'choropleth_mapbox' we can display an interactive map using the
            <strong>block</strong> GeoJSON data to define the regions and the <strong>dwellingsByBlock</strong>
            dataframe to define the summarised data by block.</p>

        </div>
      </div>
    </div>
  </div>
  <div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
        <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
          <div class="snippet-language">
            <span class="icon"><i class="fab fa-python"></i></span>
            <span class=>Python</span>
          </div>

          <figure class=" highlight hl-ipython3">
            <pre><code class="language-python" data-lang="python"><span></span><span class="c1"># Display the choropleth map</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">choropleth_mapbox</span><span class="p">(</span><span class="n">dwellingsByBlock</span><span class="p">,</span> <span class="c1"># pass in the summarised dwellings per block</span>
                           <span class="n">geojson</span><span class="o">=</span><span class="n">block</span><span class="p">,</span> <span class="c1"># pass in the GeoJSON data defining the CLUE Block polygons</span>
                           <span class="n">locations</span><span class="o">=</span><span class="s1">'block_id'</span><span class="p">,</span> <span class="c1"># define the unique identifier for the Blocks from the dataframe</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">'dwelling_count'</span><span class="p">,</span> <span class="c1"># change the colour of the block region according to the dwelling count</span>
                           <span class="n">color_continuous_scale</span><span class="o">=</span><span class="p">[</span><span class="s2">"#FFFF88"</span><span class="p">,</span> <span class="s2">"yellow"</span><span class="p">,</span> <span class="s2">"orange"</span><span class="p">,</span> <span class="s2">"orange"</span><span class="p">,</span>
                                                   <span class="s2">"orange"</span><span class="p">,</span> <span class="s2">"darkorange"</span><span class="p">,</span> <span class="s2">"red"</span><span class="p">,</span> <span class="s2">"darkred"</span><span class="p">],</span> <span class="c1"># define custom colour scale</span>
                           <span class="n">range_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dwellingsByBlock</span><span class="p">[</span><span class="s1">'dwelling_count'</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span> <span class="c1"># set the numeric range for the colour scale</span>
                           <span class="n">featureidkey</span><span class="o">=</span><span class="s2">"properties.block_id"</span><span class="p">,</span> <span class="c1"># define the Unique polygon identifier from the GeoJSON data</span>
                           <span class="n">mapbox_style</span><span class="o">=</span><span class="s2">"stamen-toner"</span><span class="p">,</span> <span class="c1"># set the visual style of the map</span>
                           <span class="n">zoom</span><span class="o">=</span><span class="mf">12.15</span><span class="p">,</span> <span class="c1"># set the zoom level</span>
                           <span class="n">center</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"lat"</span><span class="p">:</span> <span class="o">-</span><span class="mf">37.813</span><span class="p">,</span> <span class="s2">"lon"</span><span class="p">:</span> <span class="mf">144.945</span><span class="p">},</span> <span class="c1"># set the map centre coordinates</span>
                           <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="c1"># opacity of the choropleth polygons</span>
                           <span class="n">hover_name</span><span class="o">=</span><span class="s1">'clue_area'</span><span class="p">,</span> <span class="c1"># the title of the hover pop up box</span>
                           <span class="n">hover_data</span><span class="o">=</span><span class="p">{</span><span class="s1">'block_id'</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">'dwelling_count'</span><span class="p">:</span><span class="kc">True</span><span class="p">},</span> <span class="c1"># defines which dataframe fields to display</span>
                                                                               <span class="c1"># in the hover popup box</span>
                           <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">'dwelling_count'</span><span class="p">:</span><span class="s1">'Number of Dwellings'</span><span class="p">,</span><span class="s1">'block_id'</span><span class="p">:</span><span class="s1">'CLUE Block Id'</span><span class="p">},</span> <span class="c1"># defines labels for</span>
                                                                               <span class="c1"># the hover popup box</span>
                           <span class="n">title</span><span class="o">=</span><span class="s1">'Residential Dwellings by CLUE Block Id for 2020'</span><span class="p">,</span> <span class="c1"># Title for plot</span>
                           <span class="n">width</span><span class="o">=</span><span class="mi">950</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span> <span class="c1"># dimensions of plot in pixels</span>
                          <span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre>
          </figure>


        </div>
      </div>
    </div>

    <div class="jp-Cell-outputWrapper">
      <div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
      </div>


      <div class="jp-OutputArea jp-Cell-outputArea">
        <div class="jp-OutputArea-child">

          <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>





        </div>

      </div>

    </div>

  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <p>You've successfully used Melbourne CLUE Open Data and Plotly to visualise residential density in the City
            of Melbourne!<br>
            Now zoom in and out on the map above to explore the city and areas of high and low residential
            density.<br><br>
            This is your first step to selecting a suitable location for your new business!</p>

        </div>
      </div>
    </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <p><strong><a href="../dataanalysis/eda-clue-residentialdwellings.ipynb">You can explore the Residential
                Density data here</a></strong>.</p>

        </div>
      </div>
    </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <div class="usecase-section-header">Visualising Residential Density and Cafe or Restaurant Seating</div>
        </div>
      </div>
    </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <p>To build our view of cafe venue seating and how it relates to residential density we need to visualise both
            datasets on the same interactive map view.</p>
          <p>We can do this by adding a new layer (or "trace" as it is called in Plotly) to our previous map of
            residential density.</p>
          <p>Let's extract the Melbourne CLUE cafe, restaurant, bistro seats dataset and summarise it so its ready to
            plot.</p>

        </div>
      </div>
    </div>
  </div>
  <div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
        <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
          <div class="snippet-language">
            <span class="icon"><i class="fab fa-python"></i></span>
            <span class=>Python</span>
          </div>

          <figure class=" highlight hl-ipython3">
            <pre><code class="language-python" data-lang="python"><span></span><span class="c1"># Pull dataset for Cafe, restaurant and bistro seat dataset</span>
<span class="n">cafe_dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'https://data.melbourne.vic.gov.au/api/v2/catalog/datasets/cafes-and-restaurants-with-seating-capacity/exports/csv?limit=-1&amp;offset=0&amp;timezone=UTC'</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s1">';'</span><span class="p">)</span>

<span class="c1">#Filter cafe dataset for 2020</span>
<span class="n">cafe_dataset</span> <span class="o">=</span> <span class="n">cafe_dataset</span><span class="p">[</span><span class="n">cafe_dataset</span><span class="p">[</span><span class="s2">"census_year"</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2020</span><span class="p">]</span>

<span class="c1"># Cast columns to correct data type</span>
<span class="n">cafe_dataset</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"longitude"</span><span class="p">:</span><span class="s2">"x_coordinate"</span><span class="p">,</span><span class="s2">"latitude"</span><span class="p">:</span><span class="s2">"y_coordinate"</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">integer_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'census_year'</span><span class="p">,</span> <span class="s1">'block_id'</span><span class="p">,</span> <span class="s1">'property_id'</span><span class="p">,</span> <span class="s1">'base_property_id'</span><span class="p">,</span> <span class="s1">'industry_anzsic4_code'</span><span class="p">,</span> <span class="s1">'number_of_seats'</span><span class="p">]</span>
<span class="n">fp_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'x_coordinate'</span><span class="p">,</span> <span class="s1">'y_coordinate'</span><span class="p">]</span>
<span class="n">cafe_dataset</span><span class="p">[</span><span class="n">integer_columns</span><span class="p">]</span> <span class="o">=</span> <span class="n">cafe_dataset</span><span class="p">[</span><span class="n">integer_columns</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">cafe_dataset</span><span class="p">[</span><span class="n">fp_columns</span><span class="p">]</span> <span class="o">=</span> <span class="n">cafe_dataset</span><span class="p">[</span><span class="n">fp_columns</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">cafe_dataset</span> <span class="o">=</span> <span class="n">cafe_dataset</span><span class="o">.</span><span class="n">convert_dtypes</span><span class="p">()</span> <span class="c1"># convert remaining to string</span>

<span class="c1"># Summarise venue seating by location</span>
<span class="n">groupbyfields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'clue_small_area'</span><span class="p">,</span><span class="s1">'block_id'</span><span class="p">,</span><span class="s1">'y_coordinate'</span><span class="p">,</span><span class="s1">'x_coordinate'</span><span class="p">]</span>
<span class="n">aggregatebyfields</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'number_of_seats'</span><span class="p">:</span> <span class="p">[</span><span class="s2">"sum"</span><span class="p">]}</span>

<span class="n">seatsByLocn</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cafe_dataset</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">groupbyfields</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">aggregatebyfields</span><span class="p">))</span>
<span class="n">seatsByLocn</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">seatsByLocn</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">)</span> <span class="c1"># flatten column header</span>
<span class="n">seatsByLocn</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">'clue_small_area'</span><span class="p">:</span> <span class="s1">'clue_area'</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#rename to match GeoJSON extract</span>
<span class="n">seatsByLocn</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">'number_of_seatssum'</span><span class="p">:</span> <span class="s1">'number_of_seats'</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#rename to match GeoJSON extract</span>
<span class="n">seatsByLocn</span><span class="p">[</span><span class="s1">'number_of_seats'</span><span class="p">]</span> <span class="o">=</span> <span class="n">seatsByLocn</span><span class="p">[</span><span class="s1">'number_of_seats'</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># Calculate scale for drawing each bubble on scatter map plot</span>
<span class="n">all_data_diffq</span> <span class="o">=</span> <span class="p">(</span><span class="n">seatsByLocn</span><span class="p">[</span><span class="s2">"number_of_seats"</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">seatsByLocn</span><span class="p">[</span><span class="s2">"number_of_seats"</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="mi">16</span>
<span class="n">seatsByLocn</span><span class="p">[</span><span class="s1">'scale'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">seatsByLocn</span><span class="p">[</span><span class="s2">"number_of_seats"</span><span class="p">]</span> <span class="o">-</span> <span class="n">seatsByLocn</span><span class="p">[</span><span class="s2">"number_of_seats"</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="n">all_data_diffq</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">seatsByLocn</span><span class="p">[</span><span class="s1">'scale'</span><span class="p">]</span> <span class="o">=</span> <span class="n">seatsByLocn</span><span class="p">[</span><span class="s1">'scale'</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span>
<span class="n">seatsByLocn</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre>
          </figure>


        </div>
      </div>
    </div>

    <div class="jp-Cell-outputWrapper">
      <div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
      </div>


      <div class="jp-OutputArea jp-Cell-outputArea">
        <div class="jp-OutputArea-child jp-OutputArea-executeResult">

          <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[&nbsp;]:</div>



          <div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output jp-OutputArea-executeResult"
            data-mime-type="text/html">
            <div>
              <style scoped>
                .dataframe tbody tr th:only-of-type {
                  vertical-align: middle;
                }

                .dataframe tbody tr th {
                  vertical-align: top;
                }

                .dataframe thead th {
                  text-align: right;
                }
              </style>
              <table border="1" class="dataframe">
                <thead>
                  <tr style="text-align: right;">
                    <th></th>
                    <th>clue_area</th>
                    <th>block_id</th>
                    <th>y_coordinate</th>
                    <th>x_coordinate</th>
                    <th>number_of_seats</th>
                    <th>scale</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th>0</th>
                    <td>Carlton</td>
                    <td>203</td>
                    <td>-37.79671</td>
                    <td>144.96553</td>
                    <td>51</td>
                    <td>3</td>
                  </tr>
                  <tr>
                    <th>1</th>
                    <td>Carlton</td>
                    <td>203</td>
                    <td>-37.79668</td>
                    <td>144.9649</td>
                    <td>42</td>
                    <td>3</td>
                  </tr>
                  <tr>
                    <th>2</th>
                    <td>Carlton</td>
                    <td>204</td>
                    <td>-37.79783</td>
                    <td>144.96517</td>
                    <td>50</td>
                    <td>3</td>
                  </tr>
                  <tr>
                    <th>3</th>
                    <td>Carlton</td>
                    <td>204</td>
                    <td>-37.79726</td>
                    <td>144.96575</td>
                    <td>120</td>
                    <td>3</td>
                  </tr>
                  <tr>
                    <th>4</th>
                    <td>Carlton</td>
                    <td>205</td>
                    <td>-37.79946</td>
                    <td>144.96489</td>
                    <td>96</td>
                    <td>3</td>
                  </tr>
                  <tr>
                    <th>5</th>
                    <td>Carlton</td>
                    <td>205</td>
                    <td>-37.799</td>
                    <td>144.96477</td>
                    <td>80</td>
                    <td>3</td>
                  </tr>
                  <tr>
                    <th>6</th>
                    <td>Carlton</td>
                    <td>205</td>
                    <td>-37.79872</td>
                    <td>144.96526</td>
                    <td>41</td>
                    <td>3</td>
                  </tr>
                  <tr>
                    <th>7</th>
                    <td>Carlton</td>
                    <td>206</td>
                    <td>-37.80046</td>
                    <td>144.96655</td>
                    <td>51</td>
                    <td>3</td>
                  </tr>
                  <tr>
                    <th>8</th>
                    <td>Carlton</td>
                    <td>206</td>
                    <td>-37.80019</td>
                    <td>144.96672</td>
                    <td>140</td>
                    <td>3</td>
                  </tr>
                  <tr>
                    <th>9</th>
                    <td>Carlton</td>
                    <td>206</td>
                    <td>-37.80005</td>
                    <td>144.96674</td>
                    <td>115</td>
                    <td>3</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

        </div>

      </div>

    </div>

  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <p>Above we can see our summary dataframe has calculated the total number of seats (indoor and outdoor) at
            each unique locations (latitude and longitude).</p>
          <p>Since there is such a wide variance in venue seating across the city we need to scale the size of the
            bubbles drawn on the map to just a few (16) distinct sizes.</p>
          <p>We set the lowest scale to 3 to ensure even the smallest venue's bubble is large enough when one zooms in
            at block level.</p>
          <p>The next step is to display both the Choropleth and Scatter maps.
            We first draw the choropleth map showing residential density.
            We then draw the scatter plot assigning it as a trace (aka "layer") to the existing figure then show both.
          </p>

        </div>
      </div>
    </div>
  </div>
  <div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
        <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
          <div class="snippet-language">
            <span class="icon"><i class="fab fa-python"></i></span>
            <span class=>Python</span>
          </div>

          <figure class=" highlight hl-ipython3">
            <pre><code class="language-python" data-lang="python"><span></span><span class="c1"># Plot residential density and venue seating</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">choropleth_mapbox</span><span class="p">(</span><span class="n">dwellingsByBlock</span><span class="p">,</span> <span class="n">geojson</span><span class="o">=</span><span class="n">block</span><span class="p">,</span> <span class="n">locations</span><span class="o">=</span><span class="s1">'block_id'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'dwelling_count'</span><span class="p">,</span>
                           <span class="n">color_continuous_scale</span><span class="o">=</span><span class="p">[</span><span class="s2">"#FFFF88"</span><span class="p">,</span> <span class="s2">"yellow"</span><span class="p">,</span> <span class="s2">"orange"</span><span class="p">,</span> <span class="s2">"orange"</span><span class="p">,</span>
                                                   <span class="s2">"orange"</span><span class="p">,</span> <span class="s2">"darkorange"</span><span class="p">,</span> <span class="s2">"red"</span><span class="p">,</span> <span class="s2">"darkred"</span><span class="p">],</span>
                           <span class="n">range_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dwellingsByBlock</span><span class="p">[</span><span class="s1">'dwelling_count'</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span>
                           <span class="n">featureidkey</span><span class="o">=</span><span class="s2">"properties.block_id"</span><span class="p">,</span>
                           <span class="n">mapbox_style</span><span class="o">=</span><span class="s2">"stamen-toner"</span><span class="p">,</span> <span class="c1">#"carto-positron",</span>
                           <span class="n">zoom</span><span class="o">=</span><span class="mf">12.15</span><span class="p">,</span>
                           <span class="n">center</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"lat"</span><span class="p">:</span> <span class="o">-</span><span class="mf">37.813</span><span class="p">,</span> <span class="s2">"lon"</span><span class="p">:</span> <span class="mf">144.945</span><span class="p">},</span>
                           <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                           <span class="n">hover_name</span><span class="o">=</span><span class="s1">'clue_area'</span><span class="p">,</span>
                           <span class="n">hover_data</span><span class="o">=</span><span class="p">{</span><span class="s1">'block_id'</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">'dwelling_count'</span><span class="p">:</span><span class="kc">True</span><span class="p">},</span>
                           <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">'dwelling_count'</span><span class="p">:</span><span class="s1">'Number of Dwellings'</span><span class="p">,</span><span class="s1">'block_id'</span><span class="p">:</span><span class="s1">'CLUE Block Id'</span><span class="p">},</span>
                           <span class="n">title</span><span class="o">=</span><span class="s1">'Residential Dwellings Density &amp; Venue Seating (2020)'</span><span class="p">,</span>
                           <span class="n">width</span><span class="o">=</span><span class="mi">950</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span>
                          <span class="p">)</span>

<span class="c1"># Plot of venue seating</span>
<span class="n">fig2</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter_mapbox</span><span class="p">(</span><span class="n">seatsByLocn</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="s2">"y_coordinate"</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="s2">"x_coordinate"</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">"scale"</span><span class="p">,</span>
                        <span class="n">mapbox_style</span><span class="o">=</span><span class="s2">"stamen-toner"</span><span class="p">,</span>
                        <span class="n">zoom</span><span class="o">=</span><span class="mf">12.15</span><span class="p">,</span>
                        <span class="n">center</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"lat"</span><span class="p">:</span> <span class="o">-</span><span class="mf">37.813</span><span class="p">,</span> <span class="s2">"lon"</span><span class="p">:</span> <span class="mf">144.945</span><span class="p">},</span>
                        <span class="n">opacity</span><span class="o">=</span><span class="mf">0.70</span><span class="p">,</span>
                        <span class="n">hover_name</span><span class="o">=</span><span class="s2">"clue_area"</span><span class="p">,</span>
                        <span class="n">hover_data</span><span class="o">=</span><span class="p">{</span><span class="s2">"block_id"</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s2">"scale"</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s2">"number_of_seats"</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s2">"x_coordinate"</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s2">"y_coordinate"</span><span class="p">:</span><span class="kc">False</span><span class="p">},</span>
                        <span class="n">color_discrete_sequence</span><span class="o">=</span><span class="p">[</span><span class="s1">'purple'</span><span class="p">],</span>
                        <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">'number_of_seats'</span><span class="p">:</span><span class="s1">'Number of Seats'</span><span class="p">,</span> <span class="s1">'block_id'</span><span class="p">:</span><span class="s1">'CLUE Block Id'</span><span class="p">},</span>
                        <span class="n">width</span><span class="o">=</span><span class="mi">950</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">fig2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_geos</span><span class="p">(</span><span class="n">fitbounds</span><span class="o">=</span><span class="s2">"locations"</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre>
          </figure>


        </div>
      </div>
    </div>

    <div class="jp-Cell-outputWrapper">
      <div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
      </div>


      <div class="jp-OutputArea jp-Cell-outputArea">
        <div class="jp-OutputArea-child">

          <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>





        </div>

      </div>

    </div>

  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <p>You've successfully used Melbourne CLUE Open Data and Plotly to visualise residential density and venue
            seating in the City of Melbourne in one map!<br>
            Now zoom in and out on the map above to explore the city and areas of high residential density but low venue
            seating.<br><br>
            This could be a possible location for your new business!</p>

        </div>
      </div>
    </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <p><strong><a href="../dataanalysis/eda-clue-venueseats.ipynb">You can explore the Venue Seating data in more
                detail here</a></strong>.</p>

        </div>
      </div>
    </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <div class="usecase-section-header">Building an Interactive Visualisation for New Business Location</div>
        </div>
      </div>
    </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <p>In the previous step we saw how we can create a new layer, also called a trace, to an existing mapbox plot
            in order to visualise both residential density and cafe or Restaurant venue seating on the one map.</p>
          <p>We now wish to add Employment Density to this visualisation.
            Since Employment density and Residential density both require use a choropleth map to visualise data at CLUE
            block level, we cannot overlay these two layers at the same time.</p>
          <p>We therefore need a way to select the base choropleth map to show either residential density or employment
            density and then optionally turn on or off the venue seating as an additional scatter map box layer.</p>
          <p>To achieve this interactivity we can make use of Plotly express functions to build a drop down menu and
            button to be overlaid on the map.</p>
          <p>We will require three datasets and associated layers (traces) for this visualisation.</p>
          <p>Let's start by extracting our third dataset titled <strong><a
                href="https://data.melbourne.vic.gov.au/Business/Employment-per-industry-for-blocks-2020/qnju-it8g">"Employment
                per industry for blocks 2020"</a></strong> and performing some data preparation prior to plotting.</p>
          <p><em>Note: The **</em>"Employment per industry for blocks 2020"<em>** dataset is a summary of employment at
              CLUE Block level and so we do not need to perform a groupby aggregation on the dataset.</em></p>

        </div>
      </div>
    </div>
  </div>
  <div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
        <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
          <div class="snippet-language">
            <span class="icon"><i class="fab fa-python"></i></span>
            <span class=>Python</span>
          </div>

          <figure class=" highlight hl-ipython3">
            <pre><code class="language-python" data-lang="python"><span></span><span class="c1"># Pull dataset for the Job employment by block by clue industry</span>
<span class="n">jobs_dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'https://data.melbourne.vic.gov.au/api/v2/catalog/datasets/employment-by-block-by-clue-industry/exports/csv?limit=-1&amp;offset=0&amp;timezone=UTC'</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s1">';'</span><span class="p">)</span>

<span class="c1">#Filter jobs dataset for 2020</span>
<span class="n">jobs_dataset</span> <span class="o">=</span> <span class="n">jobs_dataset</span><span class="p">[</span><span class="n">jobs_dataset</span><span class="p">[</span><span class="s2">"census_year"</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2020</span><span class="p">]</span>
<span class="c1">#rename columns</span>
<span class="n">jobs_dataset</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"total_jobs_in_block"</span><span class="p">:</span><span class="s2">"total_employment_in_block"</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Filter out unwanted columns</span>
<span class="n">columnsToKeep</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'clue_small_area'</span><span class="p">,</span><span class="s1">'block_id'</span><span class="p">,</span><span class="s1">'total_employment_in_block'</span><span class="p">]</span>
<span class="n">employmentByBlock</span> <span class="o">=</span> <span class="n">jobs_dataset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">columnsToKeep</span><span class="p">)</span>

<span class="c1"># Rename to match GeoJSON extract</span>
<span class="n">employmentByBlock</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">'clue_small_area'</span><span class="p">:</span> <span class="s1">'clue_area'</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Replace all NaNs with zero</span>
<span class="n">employmentByBlock</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Cast columns to correct datatype</span>
<span class="n">employmentByBlock</span><span class="p">[[</span><span class="s1">'block_id'</span><span class="p">,</span><span class="s1">'total_employment_in_block'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">employmentByBlock</span><span class="p">[[</span><span class="s1">'block_id'</span><span class="p">,</span><span class="s1">'total_employment_in_block'</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">employmentByBlock</span> <span class="o">=</span> <span class="n">employmentByBlock</span><span class="o">.</span><span class="n">convert_dtypes</span><span class="p">()</span> <span class="c1"># convert remaining to string</span>

<span class="c1"># Exclude summary total for all of City of Melbourne</span>
<span class="n">employmentByBlock</span> <span class="o">=</span> <span class="n">employmentByBlock</span><span class="p">[</span><span class="n">employmentByBlock</span><span class="p">[</span><span class="s1">'block_id'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> 

<span class="c1"># Display sample data</span>
<span class="n">employmentByBlock</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre>
          </figure>


        </div>
      </div>
    </div>

    <div class="jp-Cell-outputWrapper">
      <div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
      </div>


      <div class="jp-OutputArea jp-Cell-outputArea">
        <div class="jp-OutputArea-child jp-OutputArea-executeResult">

          <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[&nbsp;]:</div>



          <div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output jp-OutputArea-executeResult"
            data-mime-type="text/html">
            <div>
              <style scoped>
                .dataframe tbody tr th:only-of-type {
                  vertical-align: middle;
                }

                .dataframe tbody tr th {
                  vertical-align: top;
                }

                .dataframe thead th {
                  text-align: right;
                }
              </style>
              <table border="1" class="dataframe">
                <thead>
                  <tr style="text-align: right;">
                    <th></th>
                    <th>clue_area</th>
                    <th>block_id</th>
                    <th>total_employment_in_block</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th>0</th>
                    <td>East Melbourne</td>
                    <td>662</td>
                    <td>0</td>
                  </tr>
                  <tr>
                    <th>1</th>
                    <td>Melbourne (Remainder)</td>
                    <td>663</td>
                    <td>0</td>
                  </tr>
                  <tr>
                    <th>2</th>
                    <td>Southbank</td>
                    <td>733</td>
                    <td>63</td>
                  </tr>
                  <tr>
                    <th>3</th>
                    <td>Southbank</td>
                    <td>736</td>
                    <td>82</td>
                  </tr>
                  <tr>
                    <th>4</th>
                    <td>Southbank</td>
                    <td>737</td>
                    <td>346</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

        </div>

      </div>

    </div>

  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <p>Now we have a dataset showing total number of employees by CLUE block, let's visualise it as a choropleth
            map and overlay venue seating.</p>
          <p>In this map visualisation we will use a different map style called "open-street-map" which lets us identify
            the names of venues close to where the venue seating measures have been reported. <strong>Note that not all
              venues may have been marked on Open Street Maps.</strong></p>
          <p>Mapbox styles which do not require a Mapbox API token are 'open-street-map', 'white-bg', 'carto-positron',
            'carto-darkmatter', 'stamen- terrain', 'stamen-toner', 'stamen-watercolor'. Mapbox styles which do require a
            Mapbox API token are 'basic', 'streets', 'outdoors', 'light', 'dark', 'satellite', 'satellite- streets'.</p>
          <p><strong>Source:</strong> <strong><a
                href="https://plotly.com/python-api-reference/generated/plotly.express.line_mapbox.html">plotly.express.line_mapbox
                documentation</a></strong></p>

        </div>
      </div>
    </div>
  </div>
  <div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
        <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
          <div class="snippet-language">
            <span class="icon"><i class="fab fa-python"></i></span>
            <span class=>Python</span>
          </div>

          <figure class=" highlight hl-ipython3">
            <pre><code class="language-python" data-lang="python"><span></span><span class="c1"># Plot employment density</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">choropleth_mapbox</span><span class="p">(</span><span class="n">employmentByBlock</span><span class="p">,</span> <span class="n">geojson</span><span class="o">=</span><span class="n">block</span><span class="p">,</span> <span class="n">locations</span><span class="o">=</span><span class="s1">'block_id'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'total_employment_in_block'</span><span class="p">,</span>
                           <span class="n">color_continuous_scale</span><span class="o">=</span><span class="s2">"Blues"</span><span class="p">,</span>
                           <span class="n">range_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">employmentByBlock</span><span class="p">[</span><span class="s1">'total_employment_in_block'</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span>
                           <span class="n">featureidkey</span><span class="o">=</span><span class="s2">"properties.block_id"</span><span class="p">,</span>
                           <span class="n">mapbox_style</span><span class="o">=</span><span class="s2">"open-street-map"</span><span class="p">,</span>
                           <span class="n">zoom</span><span class="o">=</span><span class="mf">12.15</span><span class="p">,</span>
                           <span class="n">center</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"lat"</span><span class="p">:</span> <span class="o">-</span><span class="mf">37.813</span><span class="p">,</span> <span class="s2">"lon"</span><span class="p">:</span> <span class="mf">144.945</span><span class="p">},</span>
                           <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                           <span class="n">hover_name</span><span class="o">=</span><span class="s1">'clue_area'</span><span class="p">,</span>
                           <span class="n">hover_data</span><span class="o">=</span><span class="p">{</span><span class="s1">'block_id'</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">'total_employment_in_block'</span><span class="p">:</span><span class="kc">True</span><span class="p">},</span>
                           <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">'total_employment_in_block'</span><span class="p">:</span><span class="s1">'Number of Employees'</span><span class="p">,</span><span class="s1">'block_id'</span><span class="p">:</span><span class="s1">'CLUE Block Id'</span><span class="p">},</span>
                           <span class="n">title</span><span class="o">=</span><span class="s1">'Employment Density &amp; Venue Seating (2020)'</span><span class="p">,</span>
                           <span class="n">width</span><span class="o">=</span><span class="mi">950</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span>
                          <span class="p">)</span>

<span class="c1"># Plot of venue seating</span>
<span class="n">fig2</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter_mapbox</span><span class="p">(</span><span class="n">seatsByLocn</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="s2">"y_coordinate"</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="s2">"x_coordinate"</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">"scale"</span><span class="p">,</span>
                        <span class="n">mapbox_style</span><span class="o">=</span><span class="s2">"stamen-toner"</span><span class="p">,</span>
                        <span class="n">zoom</span><span class="o">=</span><span class="mf">12.15</span><span class="p">,</span>
                        <span class="n">center</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"lat"</span><span class="p">:</span> <span class="o">-</span><span class="mf">37.813</span><span class="p">,</span> <span class="s2">"lon"</span><span class="p">:</span> <span class="mf">144.945</span><span class="p">},</span>
                        <span class="n">opacity</span><span class="o">=</span><span class="mf">0.70</span><span class="p">,</span>
                        <span class="n">hover_name</span><span class="o">=</span><span class="s2">"clue_area"</span><span class="p">,</span>
                        <span class="n">hover_data</span><span class="o">=</span><span class="p">{</span><span class="s2">"block_id"</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s2">"scale"</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s2">"number_of_seats"</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s2">"x_coordinate"</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s2">"y_coordinate"</span><span class="p">:</span><span class="kc">False</span><span class="p">},</span>
                        <span class="n">color_discrete_sequence</span><span class="o">=</span><span class="p">[</span><span class="s1">'purple'</span><span class="p">],</span>
                        <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">'number_of_seats'</span><span class="p">:</span><span class="s1">'Number of Seats'</span><span class="p">,</span> <span class="s1">'block_id'</span><span class="p">:</span><span class="s1">'CLUE Block Id'</span><span class="p">},</span>
                        <span class="n">width</span><span class="o">=</span><span class="mi">950</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">fig2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_geos</span><span class="p">(</span><span class="n">fitbounds</span><span class="o">=</span><span class="s2">"locations"</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre>
          </figure>


        </div>
      </div>
    </div>

    <div class="jp-Cell-outputWrapper">
      <div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
      </div>


      <div class="jp-OutputArea jp-Cell-outputArea">
        <div class="jp-OutputArea-child">

          <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>





        </div>

      </div>

    </div>

  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <div class="usecase-section-header">Combining all map layers into one interactive map box visualisation</div>
        </div>
      </div>
    </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <p>Let's now build a single map box visualisation using our three datasets.</p>
          <p>Our first step is to create a base plotly figure to which we can add each individual map plot as a new
            layer.</p>
          <p>The title of the visualisation and any common parameters can be set using the fig.update_layout() method.
          </p>
          <p>In the cell below we also have defined two custom colorscales, one continuous for the choropleth map and
            the other discrete for the scatter map plot.</p>
          <p>We then create a figure for each dataset and add it as a layer to the base figure using the fig.add_trace()
            method.</p>

        </div>
      </div>
    </div>
  </div>
  <div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
        <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
          <div class="snippet-language">
            <span class="icon"><i class="fab fa-python"></i></span>
            <span class=>Python</span>
          </div>

          <figure class=" highlight hl-ipython3">
            <pre><code class="language-python" data-lang="python"><span></span><span class="c1"># Define custom colour scale for choropleth (continuous) and scatter (discrete)</span>
<span class="n">custom_continuous_colorscale</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">"lightblue"</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="s2">"blue"</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"darkblue"</span><span class="p">)]</span>
<span class="n">custom_discrete_colorscale</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'red'</span><span class="p">]</span>

<span class="c1"># Create the base figure to which layers(traces) will be added.</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

<span class="c1"># Set the default style for the map</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">mapbox_style</span><span class="o">=</span><span class="s2">"open-street-map"</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">hovermode</span><span class="o">=</span><span class="s1">'closest'</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">mapbox_center_lat</span><span class="o">=-</span><span class="mf">37.813</span><span class="p">,</span> <span class="n">mapbox_center_lon</span><span class="o">=</span><span class="mf">144.945</span><span class="p">,</span> <span class="n">mapbox_zoom</span><span class="o">=</span><span class="mf">12.15</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">950</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">'Residential &amp; Employment Density plus Venue Seating (2020)'</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">coloraxis_colorscale</span><span class="o">=</span><span class="n">custom_continuous_colorscale</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">coloraxis_colorbar</span><span class="o">=</span><span class="p">{</span><span class="s1">'title'</span><span class="p">:</span><span class="s1">'Density'</span><span class="p">})</span>

<span class="c1"># Create the definition for the Residential Dwellings Layer</span>
<span class="n">fig1</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">choropleth_mapbox</span><span class="p">(</span><span class="n">dwellingsByBlock</span><span class="p">,</span> <span class="n">geojson</span><span class="o">=</span><span class="n">block</span><span class="p">,</span> <span class="n">locations</span><span class="o">=</span><span class="s1">'block_id'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'dwelling_count'</span><span class="p">,</span>
                           <span class="n">range_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dwellingsByBlock</span><span class="p">[</span><span class="s1">'dwelling_count'</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span>
                           <span class="n">featureidkey</span><span class="o">=</span><span class="s2">"properties.block_id"</span><span class="p">,</span>
                           <span class="n">hover_name</span><span class="o">=</span><span class="s1">'clue_area'</span><span class="p">,</span>
                           <span class="n">hover_data</span><span class="o">=</span><span class="p">{</span><span class="s1">'block_id'</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">'dwelling_count'</span><span class="p">:</span><span class="kc">True</span><span class="p">},</span>
                           <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">'dwelling_count'</span><span class="p">:</span><span class="s1">'Number of Dwellings'</span><span class="p">,</span><span class="s1">'block_id'</span><span class="p">:</span><span class="s1">'CLUE Block Id'</span><span class="p">},</span>
                           <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                           
                          <span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">fig1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># add this layer to the base figure</span>

<span class="c1"># Create the definition for the Employment Layer</span>
<span class="n">fig2</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">choropleth_mapbox</span><span class="p">(</span><span class="n">employmentByBlock</span><span class="p">,</span> <span class="n">geojson</span><span class="o">=</span><span class="n">block</span><span class="p">,</span> <span class="n">locations</span><span class="o">=</span><span class="s1">'block_id'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'total_employment_in_block'</span><span class="p">,</span>
                           <span class="n">range_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">employmentByBlock</span><span class="p">[</span><span class="s1">'total_employment_in_block'</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span>
                           <span class="n">featureidkey</span><span class="o">=</span><span class="s2">"properties.block_id"</span><span class="p">,</span>
                           <span class="n">hover_name</span><span class="o">=</span><span class="s1">'clue_area'</span><span class="p">,</span>
                           <span class="n">hover_data</span><span class="o">=</span><span class="p">{</span><span class="s1">'block_id'</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">'total_employment_in_block'</span><span class="p">:</span><span class="kc">True</span><span class="p">},</span>
                           <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">'total_employment_in_block'</span><span class="p">:</span><span class="s1">'Number of Employees'</span><span class="p">,</span><span class="s1">'block_id'</span><span class="p">:</span><span class="s1">'CLUE Block Id'</span><span class="p">},</span>
                           <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span>
                          <span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">fig2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># add this layer to the base figure</span>

<span class="c1"># Create the definition for the Venue Seating Layer</span>
<span class="n">fig3</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter_mapbox</span><span class="p">(</span><span class="n">seatsByLocn</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="s2">"y_coordinate"</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="s2">"x_coordinate"</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">"scale"</span><span class="p">,</span>
                        <span class="n">hover_name</span><span class="o">=</span><span class="s2">"clue_area"</span><span class="p">,</span>
                        <span class="n">hover_data</span><span class="o">=</span><span class="p">{</span><span class="s2">"block_id"</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s2">"scale"</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s2">"number_of_seats"</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s2">"x_coordinate"</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s2">"y_coordinate"</span><span class="p">:</span><span class="kc">False</span><span class="p">},</span>
                        <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">'number_of_seats'</span><span class="p">:</span><span class="s1">'Number of Seats'</span><span class="p">,</span> <span class="s1">'block_id'</span><span class="p">:</span><span class="s1">'CLUE Block Id'</span><span class="p">},</span>
                        <span class="n">opacity</span><span class="o">=</span><span class="mf">0.70</span><span class="p">,</span> <span class="n">color_discrete_sequence</span><span class="o">=</span><span class="n">custom_discrete_colorscale</span>
                        <span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">fig3</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># add this layer to the base figure</span>
</code></pre>
          </figure>


        </div>
      </div>
    </div>

    <div class="jp-Cell-outputWrapper">
      <div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
      </div>


      <div class="jp-OutputArea jp-Cell-outputArea">
        <div class="jp-OutputArea-child">

          <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>





        </div>

      </div>

    </div>

  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <p>Finally, we define buttons and text to appear along the top of the map.</p>
          <p>Each button turns on a combination of layers when it is clicked. The layers it turns on are defined in the
            'visible' arg array with the order of boolean values corresponding to the map layers in the order they were
            added.</p>
          <p>For example: When the 'Residential Density &amp; Seating' button is clicked it turns on the 1st and 3rd
            layer as defined by the following argument 'visible':[True, False, True] . The 1st layer was the Residential
            Dwelling density choropleth map and the 3rd layer was the Venue Seating Scatter map.</p>

        </div>
      </div>
    </div>
  </div>
  <div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
        <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
          <div class="snippet-language">
            <span class="icon"><i class="fab fa-python"></i></span>
            <span class=>Python</span>
          </div>

          <figure class=" highlight hl-ipython3">
            <pre><code class="language-python" data-lang="python"><span></span><span class="c1"># Turn off all choropleth layers</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">'choroplethmapbox'</span><span class="p">))</span>

<span class="c1"># Add buttons for selection on plot</span>
<span class="n">buttons</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">'update'</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="s1">'Venue Seating only'</span><span class="p">,</span>  <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">'label'</span><span class="p">:</span> <span class="s1">'Venue Seating'</span><span class="p">,</span> <span class="s1">'visible'</span><span class="p">:[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]}]),</span>
           <span class="nb">dict</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">'update'</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="s1">'Residential Density &amp; Seating'</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">'label'</span><span class="p">:</span> <span class="s1">'Residential Dwelling Density'</span><span class="p">,</span><span class="s1">'visible'</span><span class="p">:[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]}]),</span>
           <span class="nb">dict</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">'update'</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="s1">'Employment Density &amp; Seating'</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">'label'</span><span class="p">:</span> <span class="s1">'Employment Density'</span><span class="p">,</span><span class="s1">'visible'</span><span class="p">:[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]}])</span>
          <span class="p">]</span>
                   
<span class="n">um_buttons</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">'active'</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">'showactive'</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">'buttons'</span><span class="p">:</span><span class="n">buttons</span><span class="p">,</span>
               <span class="s1">'direction'</span><span class="p">:</span> <span class="s1">'down'</span><span class="p">,</span> <span class="s1">'xanchor'</span><span class="p">:</span> <span class="s1">'left'</span><span class="p">,</span><span class="s1">'yanchor'</span><span class="p">:</span> <span class="s1">'bottom'</span><span class="p">,</span> <span class="s1">'x'</span><span class="p">:</span> <span class="mf">0.71</span><span class="p">,</span> <span class="s1">'y'</span><span class="p">:</span> <span class="mf">1.01</span><span class="p">}]</span>
<span class="n">map_annotations</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">'text'</span><span class="p">:</span><span class="s1">'Please select a map view to display'</span><span class="p">,</span> <span class="s1">'x'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'y'</span><span class="p">:</span> <span class="mf">1.1</span><span class="p">,</span>
                    <span class="s1">'showarrow'</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">'font'</span><span class="p">:{</span><span class="s1">'family'</span><span class="p">:</span><span class="s1">'Arial'</span><span class="p">,</span><span class="s1">'size'</span><span class="p">:</span><span class="mi">14</span><span class="p">}}]</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">updatemenus</span><span class="o">=</span><span class="n">um_buttons</span><span class="p">,</span> <span class="n">annotations</span><span class="o">=</span><span class="n">map_annotations</span><span class="p">)</span>

<span class="c1"># Display the map</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre>
          </figure>


        </div>
      </div>
    </div>

    <div class="jp-Cell-outputWrapper">
      <div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
      </div>


      <div class="jp-OutputArea jp-Cell-outputArea">
        <div class="jp-OutputArea-child">

          <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>





        </div>

      </div>

    </div>

  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <div class="usecase-section-header">Congratulations. Our interactive map is now complete!</div>
        </div>
      </div>
    </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
          <p>Now you can use the controls on the map above to explore the City of Melbourne and observe the residential
            density and employment density of each city block in relation to venue seating capacity.<br><br></p>
          <p>If you would like to extend this interactive map further, please visit the <strong><a
                href="https://data.melbourne.vic.gov.au/">City of Melbourne Open Data Site</a></strong> and explore some
            of the other valuable datasets including:</p>
          <ul>
            <li><strong><a href="https://data.melbourne.vic.gov.au/Transport/Off-street-car-parking-2020/g9am-cna5">Off
                  Street Parking</a></strong></li>
            <li><strong><a
                  href="https://data.melbourne.vic.gov.au/Transport/Pedestrian-Counting-System-Monthly-counts-per-hour/b2ak-trbp">Pedestrian
                  Counting System</a></strong></li>
            <li><strong><a
                  href="https://data.melbourne.vic.gov.au/Environment/Microclimate-Sensor-Readings/u4vh-84j8?src=featured_banner">Microclimate
                  sensor readings</a></strong></li>
          </ul>

        </div>
      </div>
    </div>
  </div>
</div>

<script>
  hljs.highlightAll();
</script>

{% endblock %}